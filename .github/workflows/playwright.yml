name: Google Calendar Test Automation
on:
  push:
    branches: [ main ] # ì½”ë“œë¥¼ ì˜¬ë¦´ ë•Œë§ˆë‹¤ ì‹¤í–‰
  schedule:
    - cron: '0 0 * * *' # ë§¤ì¼ í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ì „ 9ì‹œ(UTC 0ì‹œ)ì— ì‹¤í–‰

jobs:
  test:
    runs-on: ubuntu-latest # ê¹ƒí—ˆë¸Œê°€ ë¹Œë ¤ì£¼ëŠ” ë¦¬ëˆ…ìŠ¤ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰
    steps:
      - uses: actions/checkout@v4 # 1. ë‚´ ì½”ë“œë¥¼ ê°€ì ¸ì˜¨ë‹¤
      - uses: actions/setup-node@v4 # 2. Node.jsë¥¼ ì„¤ì¹˜í•œë‹¤
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci # 3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

      - name: Install Playwright Browsers
        run: npx playwright install --with-deps # 4. ë¸Œë¼ìš°ì € ì„¤ì¹˜

      - name: Run Playwright tests
        run: npx playwright test # 5. í…ŒìŠ¤íŠ¸ ì‹¤í–‰!
        env:
          # ê¹ƒí—ˆë¸Œ Secretsì— ì €ì¥í•œ ê°’ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ë¶ˆëŸ¬ì˜¨ë‹¤
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          REFRESH_TOKEN: ${{ secrets.REFRESH_TOKEN }}

      - name: Upload Report # 6. í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ë¥¼ ì €ì¥í•œë‹¤
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: playwright-report
          path: playwright-report/
          retention-days: 30

      - name: Slack Notification
        if: always() # í…ŒìŠ¤íŠ¸ ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ í•­ìƒ ì‹¤í–‰
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
          SLACK_COLOR: ${{ job.status }} # ì„±ê³µí•˜ë©´ ì´ˆë¡, ì‹¤íŒ¨í•˜ë©´ ë¹¨ê°•ìœ¼ë¡œ í‘œì‹œ
          SLACK_MESSAGE: "êµ¬ê¸€ ìº˜ë¦°ë” API í…ŒìŠ¤íŠ¸ ê²°ê³¼ì…ë‹ˆë‹¤. ìƒì„¸ ë‚´ìš©ì€ ê¹ƒí—ˆë¸Œ ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”! ğŸš€"
          SLACK_TITLE: "Test Results: ${{ job.status }}"